<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 利用R語言進行非監督式機器學習 | R語言課程講義</title>
  <meta name="description" content="本課程介紹R語言的基本語法以及一些簡單的應用。" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 利用R語言進行非監督式機器學習 | R語言課程講義" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="本課程介紹R語言的基本語法以及一些簡單的應用。" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 利用R語言進行非監督式機器學習 | R語言課程講義" />
  
  <meta name="twitter:description" content="本課程介紹R語言的基本語法以及一些簡單的應用。" />
  

<meta name="author" content="林頌堅" />


<meta name="date" content="2019-08-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="statistical-analysis.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R語言課程講義</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> R語言的基本概念與語法</a><ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#e8aab2e7a88be7b0a1e4bb8b"><i class="fa fa-check"></i>課程簡介</a><ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#-1"><i class="fa fa-check"></i>課程簡介</a></li>
<li class="chapter" data-level="1.0.1" data-path="intro.html"><a href="intro.html#section-1.0.1"><i class="fa fa-check"></i><b>1.0.1</b> 學習目標</a></li>
</ul></li>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#r"><i class="fa fa-check"></i><b>1.1</b> R語言的基本概念</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#r"><i class="fa fa-check"></i><b>1.2</b> R語言的運算</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#r"><i class="fa fa-check"></i><b>1.3</b> R語言的基本資料型態</a><ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#section-1.3.1"><i class="fa fa-check"></i><b>1.3.1</b> 數值資料型態</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#section-1.3.2"><i class="fa fa-check"></i><b>1.3.2</b> 文字資料型態</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#section-1.3.3"><i class="fa fa-check"></i><b>1.3.3</b> 邏輯資料型態</a></li>
<li class="chapter" data-level="1.3.4" data-path="intro.html"><a href="intro.html#factor"><i class="fa fa-check"></i><b>1.3.4</b> factor資料型態</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#r"><i class="fa fa-check"></i><b>1.4</b> R語言的特殊資料型態</a><ul>
<li class="chapter" data-level="1.4.1" data-path="intro.html"><a href="intro.html#vector"><i class="fa fa-check"></i><b>1.4.1</b> vector</a></li>
<li class="chapter" data-level="1.4.2" data-path="intro.html"><a href="intro.html#matrix"><i class="fa fa-check"></i><b>1.4.2</b> matrix</a></li>
<li class="chapter" data-level="1.4.3" data-path="intro.html"><a href="intro.html#list"><i class="fa fa-check"></i><b>1.4.3</b> list</a></li>
<li class="chapter" data-level="1.4.4" data-path="intro.html"><a href="intro.html#data-frame"><i class="fa fa-check"></i><b>1.4.4</b> data frame</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#e5b08fe7b590"><i class="fa fa-check"></i>小結</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#e5bbb6e4bcb8e6809de88083"><i class="fa fa-check"></i>延伸思考</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-manipulation.html"><a href="data-manipulation.html"><i class="fa fa-check"></i><b>2</b> 運用R語言進行資料處理</a><ul>
<li class="chapter" data-level="" data-path="data-manipulation.html"><a href="data-manipulation.html#-2"><i class="fa fa-check"></i>課程簡介</a><ul>
<li class="chapter" data-level="" data-path="data-manipulation.html"><a href="data-manipulation.html#-3"><i class="fa fa-check"></i>課程簡介</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#-1"><i class="fa fa-check"></i>學習目標</a></li>
</ul></li>
<li class="chapter" data-level="2.1" data-path="data-manipulation.html"><a href="data-manipulation.html#section-2.1"><i class="fa fa-check"></i><b>2.1</b> 預備工作</a><ul>
<li class="chapter" data-level="2.1.1" data-path="data-manipulation.html"><a href="data-manipulation.html#section-2.1.1"><i class="fa fa-check"></i><b>2.1.1</b> 設定工作目錄</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-manipulation.html"><a href="data-manipulation.html#section-2.2"><i class="fa fa-check"></i><b>2.2</b> 讀入檔案資料</a><ul>
<li class="chapter" data-level="2.2.1" data-path="data-manipulation.html"><a href="data-manipulation.html#section-2.2.1"><i class="fa fa-check"></i><b>2.2.1</b> 讀入空氣品質指標資料</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-manipulation.html"><a href="data-manipulation.html#section-2.2.2"><i class="fa fa-check"></i><b>2.2.2</b> 瀏覽讀入的資料</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-manipulation.html"><a href="data-manipulation.html#section-2.3"><i class="fa fa-check"></i><b>2.3</b> 資料整理</a><ul>
<li class="chapter" data-level="2.3.1" data-path="data-manipulation.html"><a href="data-manipulation.html#aqina"><i class="fa fa-check"></i><b>2.3.1</b> 去除AQI為NA的資料紀錄</a></li>
<li class="chapter" data-level="2.3.2" data-path="data-manipulation.html"><a href="data-manipulation.html#variable"><i class="fa fa-check"></i><b>2.3.2</b> Variable資料型態變更</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data-manipulation.html"><a href="data-manipulation.html#section-2.4"><i class="fa fa-check"></i><b>2.4</b> 資料分析</a><ul>
<li class="chapter" data-level="2.4.1" data-path="data-manipulation.html"><a href="data-manipulation.html#section-2.4.1"><i class="fa fa-check"></i><b>2.4.1</b> 找出某一縣市的偵測站</a></li>
<li class="chapter" data-level="2.4.2" data-path="data-manipulation.html"><a href="data-manipulation.html#section-2.4.2"><i class="fa fa-check"></i><b>2.4.2</b> 找出空氣品質最糟糕的偵測站</a></li>
<li class="chapter" data-level="2.4.3" data-path="data-manipulation.html"><a href="data-manipulation.html#section-2.4.3"><i class="fa fa-check"></i><b>2.4.3</b> 找出汙染物是細懸浮微粒的偵測站數量</a></li>
<li class="chapter" data-level="2.4.4" data-path="data-manipulation.html"><a href="data-manipulation.html#section-2.4.4"><i class="fa fa-check"></i><b>2.4.4</b> 計算各種空氣品質狀態的偵測站數量</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="data-manipulation.html"><a href="data-manipulation.html#section-2.5"><i class="fa fa-check"></i><b>2.5</b> 程式存檔</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#-1"><i class="fa fa-check"></i>小結</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#-1"><i class="fa fa-check"></i>延伸思考</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>3</b> Tidyverse簡介</a><ul>
<li class="chapter" data-level="" data-path="tidyverse.html"><a href="tidyverse.html#-4"><i class="fa fa-check"></i>課程簡介</a><ul>
<li class="chapter" data-level="" data-path="tidyverse.html"><a href="tidyverse.html#-5"><i class="fa fa-check"></i>課程簡介</a></li>
<li class="chapter" data-level="" data-path="data-manipulation.html"><a href="data-manipulation.html#-2"><i class="fa fa-check"></i>學習目標</a></li>
</ul></li>
<li class="chapter" data-level="3.1" data-path="tidyverse.html"><a href="tidyverse.html#tidy"><i class="fa fa-check"></i><b>3.1</b> tidy資料格式簡介</a><ul>
<li class="chapter" data-level="3.1.1" data-path="tidyverse.html"><a href="tidyverse.html#tidy"><i class="fa fa-check"></i><b>3.1.1</b> tidy資料格式的特徵</a></li>
<li class="chapter" data-level="3.1.2" data-path="tidyverse.html"><a href="tidyverse.html#tidy"><i class="fa fa-check"></i><b>3.1.2</b> tidy資料格式的優點</a></li>
<li class="chapter" data-level="3.1.3" data-path="tidyverse.html"><a href="tidyverse.html#wide-format-vs.long-format"><i class="fa fa-check"></i><b>3.1.3</b> wide format vs. long format</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="tidyverse.html"><a href="tidyverse.html#tidyverse"><i class="fa fa-check"></i><b>3.2</b> tidyverse套件</a></li>
<li class="chapter" data-level="3.3" data-path="tidyverse.html"><a href="tidyverse.html#tidy-data-format"><i class="fa fa-check"></i><b>3.3</b> tidy data format的資料分析方法</a><ul>
<li class="chapter" data-level="3.3.1" data-path="intro.html"><a href="intro.html#-1"><i class="fa fa-check"></i><b>3.3.1</b> 預備工作</a></li>
<li class="chapter" data-level="3.3.2" data-path="tidyverse.html"><a href="tidyverse.html#tidyverse"><i class="fa fa-check"></i><b>3.3.2</b> 使用tidyverse套件的函數</a></li>
<li class="chapter" data-level="3.3.3" data-path="intro.html"><a href="intro.html#-1"><i class="fa fa-check"></i><b>3.3.3</b> 資料整理</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="intro.html"><a href="intro.html#-1"><i class="fa fa-check"></i><b>3.4</b> 資料分析</a><ul>
<li class="chapter" data-level="3.4.1" data-path="intro.html"><a href="intro.html#-1"><i class="fa fa-check"></i><b>3.4.1</b> 找出某一縣市的偵測站</a></li>
<li class="chapter" data-level="3.4.2" data-path="intro.html"><a href="intro.html#-1"><i class="fa fa-check"></i><b>3.4.2</b> 找出空氣品質最糟糕的偵測站</a></li>
<li class="chapter" data-level="3.4.3" data-path="intro.html"><a href="intro.html#-1"><i class="fa fa-check"></i><b>3.4.3</b> 找出汙染物是細懸浮微粒的偵測站數量</a></li>
<li class="chapter" data-level="3.4.4" data-path="intro.html"><a href="intro.html#-1"><i class="fa fa-check"></i><b>3.4.4</b> 計算各種空氣品質狀態的偵測站數量</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-manipulation.html"><a href="data-manipulation.html#-2"><i class="fa fa-check"></i>小結</a></li>
<li class="chapter" data-level="" data-path="data-manipulation.html"><a href="data-manipulation.html#-2"><i class="fa fa-check"></i>延伸思考</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-visualization.html"><a href="data-visualization.html"><i class="fa fa-check"></i><b>4</b> 資料視覺化</a><ul>
<li class="chapter" data-level="" data-path="data-visualization.html"><a href="data-visualization.html#-6"><i class="fa fa-check"></i>課程簡介</a><ul>
<li class="chapter" data-level="" data-path="data-visualization.html"><a href="data-visualization.html#-7"><i class="fa fa-check"></i>課程簡介</a></li>
<li class="chapter" data-level="" data-path="data-manipulation.html"><a href="data-manipulation.html#-3"><i class="fa fa-check"></i>學習目標</a></li>
</ul></li>
<li class="chapter" data-level="4.1" data-path="data-visualization.html"><a href="data-visualization.html#section-4.1"><i class="fa fa-check"></i><b>4.1</b> 資訊視覺化簡介</a></li>
<li class="chapter" data-level="4.2" data-path="intro.html"><a href="intro.html#r"><i class="fa fa-check"></i><b>4.2</b> R語言的資料視覺化工具</a><ul>
<li class="chapter" data-level="4.2.1" data-path="data-visualization.html"><a href="data-visualization.html#ggplot2"><i class="fa fa-check"></i><b>4.2.1</b> ggplot2的運作概念</a></li>
<li class="chapter" data-level="4.2.2" data-path="data-visualization.html"><a href="data-visualization.html#aesthetics"><i class="fa fa-check"></i><b>4.2.2</b> Aesthetics上幾種常用的資料編碼方式</a></li>
<li class="chapter" data-level="4.2.3" data-path="data-visualization.html"><a href="data-visualization.html#ggplot2-geometrics"><i class="fa fa-check"></i><b>4.2.3</b> ggplot2上幾種常用的圖表類型 (Geometrics)</a></li>
<li class="chapter" data-level="4.2.4" data-path="data-visualization.html"><a href="data-visualization.html#ggplot2"><i class="fa fa-check"></i><b>4.2.4</b> 使用ggplot2套件</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data-visualization.html"><a href="data-visualization.html#section-4.3"><i class="fa fa-check"></i><b>4.3</b> 以資料視覺化的方式進行資料探索</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data-manipulation.html"><a href="data-manipulation.html#-2"><i class="fa fa-check"></i><b>4.3.1</b> 預備工作</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-visualization.html"><a href="data-visualization.html#section-4.3.2"><i class="fa fa-check"></i><b>4.3.2</b> 問題</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-visualization.html"><a href="data-visualization.html#section-4.4"><i class="fa fa-check"></i><b>4.4</b> 利用直方圖呈現資料的分布情形</a></li>
<li class="chapter" data-level="4.5" data-path="data-visualization.html"><a href="data-visualization.html#section-4.5"><i class="fa fa-check"></i><b>4.5</b> 利用長條圖進行資料之間的比較</a></li>
<li class="chapter" data-level="4.6" data-path="data-visualization.html"><a href="data-visualization.html#section-4.6"><i class="fa fa-check"></i><b>4.6</b> 利用散佈圖呈現兩個數值之間的關係</a></li>
<li class="chapter" data-level="4.7" data-path="data-visualization.html"><a href="data-visualization.html#section-4.7"><i class="fa fa-check"></i><b>4.7</b> 使用盒狀圖比較多個群體的分布情形</a></li>
<li class="chapter" data-level="4.8" data-path="data-visualization.html"><a href="data-visualization.html#section-4.8"><i class="fa fa-check"></i><b>4.8</b> 利用並列的多個圖表進行比較</a></li>
<li class="chapter" data-level="" data-path="data-manipulation.html"><a href="data-manipulation.html#-3"><i class="fa fa-check"></i>小結</a></li>
<li class="chapter" data-level="" data-path="data-manipulation.html"><a href="data-manipulation.html#-3"><i class="fa fa-check"></i>延伸思考</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>5</b> 利用R語言進行探索性資料分析</a><ul>
<li class="chapter" data-level="" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#-8"><i class="fa fa-check"></i>課程簡介</a><ul>
<li class="chapter" data-level="" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#-9"><i class="fa fa-check"></i>課程簡介</a></li>
<li class="chapter" data-level="" data-path="tidyverse.html"><a href="tidyverse.html#-4"><i class="fa fa-check"></i>學習目標</a></li>
</ul></li>
<li class="chapter" data-level="5.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-5.1"><i class="fa fa-check"></i><b>5.1</b> 探索性資料分析是什麼？</a></li>
<li class="chapter" data-level="5.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-5.2"><i class="fa fa-check"></i><b>5.2</b> 以環保署日空氣品質指標開放資料為例進行探索性資料分析</a></li>
<li class="chapter" data-level="" data-path="tidyverse.html"><a href="tidyverse.html#-4"><i class="fa fa-check"></i>小結</a></li>
<li class="chapter" data-level="" data-path="tidyverse.html"><a href="tidyverse.html#-4"><i class="fa fa-check"></i>延伸思考</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="statistical-analysis.html"><a href="statistical-analysis.html"><i class="fa fa-check"></i><b>6</b> 利用R語言進行基本的統計分析</a><ul>
<li class="chapter" data-level="" data-path="statistical-analysis.html"><a href="statistical-analysis.html#-10"><i class="fa fa-check"></i>課程簡介</a><ul>
<li class="chapter" data-level="" data-path="statistical-analysis.html"><a href="statistical-analysis.html#-11"><i class="fa fa-check"></i>課程簡介</a></li>
</ul></li>
<li class="chapter" data-level="6.1" data-path="statistical-analysis.html"><a href="statistical-analysis.html#section-6.1"><i class="fa fa-check"></i><b>6.1</b> 描述性統計</a><ul>
<li class="chapter" data-level="6.1.1" data-path="statistical-analysis.html"><a href="statistical-analysis.html#section-6.1.1"><i class="fa fa-check"></i><b>6.1.1</b> 測量資料的集中趨勢</a></li>
<li class="chapter" data-level="6.1.2" data-path="statistical-analysis.html"><a href="statistical-analysis.html#section-6.1.2"><i class="fa fa-check"></i><b>6.1.2</b> 測量資料的離散程度</a></li>
<li class="chapter" data-level="6.1.3" data-path="statistical-analysis.html"><a href="statistical-analysis.html#section-6.1.3"><i class="fa fa-check"></i><b>6.1.3</b> 偏態與峰態</a></li>
<li class="chapter" data-level="6.1.4" data-path="tidyverse.html"><a href="tidyverse.html#-5"><i class="fa fa-check"></i><b>6.1.4</b> 小結</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="statistical-analysis.html"><a href="statistical-analysis.html#section-6.2"><i class="fa fa-check"></i><b>6.2</b> 資料相關性</a></li>
<li class="chapter" data-level="6.3" data-path="statistical-analysis.html"><a href="statistical-analysis.html#section-6.3"><i class="fa fa-check"></i><b>6.3</b> 比較兩組資料的平均數</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exploratory_data_analysis"><i class="fa fa-check"></i><b>7</b> 利用R語言進行非監督式機器學習</a><ul>
<li class="chapter" data-level="" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#-12"><i class="fa fa-check"></i>課程簡介</a><ul>
<li class="chapter" data-level="" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#-13"><i class="fa fa-check"></i>課程簡介</a></li>
<li class="chapter" data-level="" data-path="tidyverse.html"><a href="tidyverse.html#-5"><i class="fa fa-check"></i>學習目標</a></li>
</ul></li>
<li class="chapter" data-level="7.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-7.1"><i class="fa fa-check"></i><b>7.1</b> 資料探勘的定義</a><ul>
<li class="chapter" data-level="7.1.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-7.1.1"><i class="fa fa-check"></i><b>7.1.1</b> 資料探勘的步驟</a></li>
<li class="chapter" data-level="7.1.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-7.1.2"><i class="fa fa-check"></i><b>7.1.2</b> 資料探勘的分類</a></li>
<li class="chapter" data-level="7.1.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-7.1.3"><i class="fa fa-check"></i><b>7.1.3</b> 集群分析</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-7.2"><i class="fa fa-check"></i><b>7.2</b> 以進出站人數統計資料對臺鐵各站點進行集群分析</a><ul>
<li class="chapter" data-level="7.2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-7.2.1"><i class="fa fa-check"></i><b>7.2.1</b> 載入相關套件</a></li>
<li class="chapter" data-level="7.2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-7.2.2"><i class="fa fa-check"></i><b>7.2.2</b> 讀取資料</a></li>
<li class="chapter" data-level="7.2.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-7.2.3"><i class="fa fa-check"></i><b>7.2.3</b> 查看資料的樣貌與修改可能的錯誤</a></li>
<li class="chapter" data-level="7.2.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-7.2.4"><i class="fa fa-check"></i><b>7.2.4</b> 產生站點資料特徵</a></li>
<li class="chapter" data-level="7.2.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-7.2.5"><i class="fa fa-check"></i><b>7.2.5</b> 維度縮減</a></li>
<li class="chapter" data-level="7.2.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-7.2.6"><i class="fa fa-check"></i><b>7.2.6</b> 將站點依據彼此距離視覺化</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#section-7.3"><i class="fa fa-check"></i><b>7.3</b> 站點分群</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R語言課程講義</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exploratory_data_analysis" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> 利用R語言進行非監督式機器學習</h1>
<div id="-12" class="section level2 unnumbered">
<h2>課程簡介</h2>
<div id="-13" class="section level3 unnumbered">
<h3>課程簡介</h3>
</div>
<div id="-5" class="section level3 unnumbered">
<h3>學習目標</h3>
<p>運用探索性資料分析</p>
</div>
</div>
<div id="section-7.1" class="section level2">
<h2><span class="header-section-number">7.1</span> 資料探勘的定義</h2>
<p><strong>資料探勘 (Data Mining)</strong>是利用電腦演算法發掘大量資料中蘊藏的規律性、樣式或知識，以幫助人們了解與說明資料的特性或者應用規律性與樣式來預測新的資料，這些規律性與樣式以人的認知能力通常並不容易發現。一般來說，資料探勘的任務目的包括預測(prediction)、關連(association)、集群(clustering)、異常偵測(anomaly detection)等等。</p>
<ul>
<li><p>預測是根據蒐集的Observation資料特徵建立一個模型(model)，來判斷新的Observation可能的資訊，蒐集的Observation一般稱為訓練集(training set)資料。預測的資訊可能是新Observations上的某一個未知數值或是實體所屬的類別，當預測的目的是判斷Observations的類別時，這種資料探勘任務又稱為分類(classification)。比較著名的預測例子，根據天氣預報資料以及地區以往雨具銷售情形，判斷未來一段時間內的雨具銷售。又如垃圾郵件偵測，便是從一些已經標示為垃圾郵件與非垃圾郵件的文字資料訓練出模型來判斷新進郵件是否為垃圾郵件。</p></li>
<li><p>關連是發現在訓練資料中經常一起出現的特徵，最有名的例子便是運用購物籃分析(market basket analysis)發現啤酒與尿布的關連。</p></li>
<li><p>集群是根據Observations之間的相似性(或者距離)，找出一種將Observations劃分成若干群的方式，盡可能使得群內的Observations彼此間的相似性大於任何群外的Observations (或是彼此間的距離小於群外的距離)。相關的例子有根據詞語的上下文資訊找出語意相關的詞語集群。 (舉例而言，政治、經濟、財稅金融、影視娛樂、運動或者醫療健康等相同文類的詞語它們彼此的上下文資訊應當很相像，但和其他文類的詞語會有相當不同的上下文資訊，因此可以依據上下文資訊對詞語進行集群分析。未來會有一章專門介紹詞語的集群分析。)</p></li>
<li><p>異常偵測則是發現某一些Observations，其資料特性與其他多數者明顯不同。例如從信用卡的交易資料中發現盜刷的交易，或是找出健保詐騙的醫療處方箋。</p></li>
</ul>
<div id="section-7.1.1" class="section level3">
<h3><span class="header-section-number">7.1.1</span> 資料探勘的步驟</h3>
<p>資料探勘的目的可以定義為一個從資料庫中發現知識的過程 (Knowledge Discovering in Databases, KDD)，依據Fayyad等人於1996年提出的構想，整個KDD過程包括</p>
<ol style="list-style-type: decimal">
<li>選取資料</li>
<li>資料的清除與整理等前處理</li>
<li>轉換資料為有效描述和預測的特徵</li>
<li>運用機器學習(machine learning)的技術建立資料模型 (狹義的資料探勘)</li>
<li>解釋與應用</li>
</ol>
</div>
<div id="section-7.1.2" class="section level3">
<h3><span class="header-section-number">7.1.2</span> 資料探勘的分類</h3>
<p>資料探勘的過程中運用機器學習的技術，可以依據是否有一部份資料中加入人類判斷、用來做為預測其他資料的訊息大致區分成<strong>監督式學習(supervised learning)</strong>和<strong>非監督式學習(unsupervised learning)</strong>。以上述的應用而言，預測大多屬於監督式學習，而集群則一般認為是非監督式學習。本章介紹非監督式學習中的集群分析。</p>
</div>
<div id="section-7.1.3" class="section level3">
<h3><span class="header-section-number">7.1.3</span> 集群分析</h3>
<p>如前所言，集群分析是根據資料的特性，設法找到一個可以良好地將彼此相似性。</p>
<p>集群分析的演算法非常多，如</p>
<ol style="list-style-type: decimal">
<li>K-means</li>
<li>EM (expectation-maximization)</li>
<li>AHC (agglomerative hierarchical clustering, 聚合式階層集群)</li>
<li>DBSCAN</li>
<li>AP (affinity propagation) …</li>
</ol>
<p>本節將利用AP演算發，對台鐵各站點，依照進出站人數統計資料的相似性，進行集群分析。</p>
</div>
</div>
<div id="section-7.2" class="section level2">
<h2><span class="header-section-number">7.2</span> 以進出站人數統計資料對臺鐵各站點進行集群分析</h2>
<div id="section-7.2.1" class="section level3">
<h3><span class="header-section-number">7.2.1</span> 載入相關套件</h3>
<p>首先載入輸入與處理資料的相關套件，因為臺鐵的資料多為JSON型式，所以載入JSON處理相關套件<code>jsonlite</code>。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(jsonlite)</code></pre></div>
</div>
<div id="section-7.2.2" class="section level3">
<h3><span class="header-section-number">7.2.2</span> 讀取資料</h3>
<p>讀取臺鐵的<a href="https://data.gov.tw/dataset/8792">每日各站點進出人數</a>資料。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(<span class="st">&quot;https://ods.railway.gov.tw/tra-ods-web/ods/download/dataResource/8ae4cabf6973990e0169947ed32454b9&quot;</span>)</code></pre></div>
<p>查看資料型態</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(df)</code></pre></div>
<pre><code>##   trnOpDate           staCode          gateInComingCnt   
##  Length:23796       Length:23796       Length:23796      
##  Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character  
##  gateOutGoingCnt   
##  Length:23796      
##  Class :character  
##  Mode  :character</code></pre>
<p>將trnOpDate改變為日期資料型態，gateInComingCnt和gateOutGoingCnt則分別改為numeric資料型態。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trnOpDate=</span><span class="kw">ymd</span>(trnOpDate)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gateInComingCnt=</span><span class="kw">as.numeric</span>(gateInComingCnt)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gateOutGoingCnt=</span><span class="kw">as.numeric</span>(gateOutGoingCnt))</code></pre></div>
<p>因為出入站資料僅有包含站點編號，所以從另外一個開放資料<a href="https://data.gov.tw/dataset/33425">車站基本資料集</a>，讀取站點名稱資料。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">site.df &lt;-<span class="st"> </span><span class="kw">fromJSON</span>(<span class="st">&quot;http://ods.railway.gov.tw/tra-ods-web/ods/download/dataResource/0518b833e8964d53bfea3f7691aea0ee&quot;</span>)</code></pre></div>
<p>將進出站點資料加入站點名稱。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">select</span>(site.df, <span class="dt">staCode=</span>stationCode, <span class="dt">staName=</span>stationName))</code></pre></div>
<p>是否有站點資料缺少站點名稱？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df[<span class="kw">is.na</span>(df<span class="op">$</span>staName),]</code></pre></div>
<p>刪除沒有站點名稱的資料</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(staName))</code></pre></div>
</div>
<div id="section-7.2.3" class="section level3">
<h3><span class="header-section-number">7.2.3</span> 查看資料的樣貌與修改可能的錯誤</h3>
<p>畫出台北進出站人數範圍</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(staName<span class="op">==</span><span class="st">&quot;臺北&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">In=</span>gateInComingCnt, <span class="dt">Out=</span>gateOutGoingCnt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span>IO, <span class="dt">value=</span>Count, <span class="op">-</span>staName, <span class="op">-</span>staCode, <span class="op">-</span>trnOpDate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>trnOpDate, <span class="dt">y=</span>Count, <span class="dt">color=</span>IO)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">90000</span>), <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">90000</span>, <span class="dv">10000</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;日期&quot;</span>, <span class="dt">y=</span><span class="st">&quot;進出站人數&quot;</span>, <span class="dt">color=</span><span class="st">&quot;進出&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;grey20&quot;</span>),
        <span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;grey90&quot;</span>))</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-9-1.png" width="672" /> 從圖形上可以觀察到5月後資料的數量級較之前大非常多，可能導致分析錯誤。</p>
<p>所有站點的進出人數總和是否有同樣情形？</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(trnOpDate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">In=</span><span class="kw">sum</span>(gateInComingCnt), <span class="dt">Out=</span><span class="kw">sum</span>(gateOutGoingCnt)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span>IO, <span class="dt">value=</span>Count, <span class="op">-</span>trnOpDate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>trnOpDate, <span class="dt">y=</span>Count, <span class="dt">color=</span>IO)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">900000</span>), <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">900000</span>, <span class="dv">100000</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;日期&quot;</span>, <span class="dt">y=</span><span class="st">&quot;進出站人數&quot;</span>, <span class="dt">color=</span><span class="st">&quot;進出&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;grey20&quot;</span>),
        <span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;grey90&quot;</span>))</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>刪除五月以前的資料，再重新檢視。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(trnOpDate<span class="op">&gt;=</span><span class="kw">as.Date</span>(<span class="st">&quot;2019-05-01&quot;</span>))

df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(trnOpDate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">In=</span><span class="kw">sum</span>(gateInComingCnt), <span class="dt">Out=</span><span class="kw">sum</span>(gateOutGoingCnt)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span>IO, <span class="dt">value=</span>Count, <span class="op">-</span>trnOpDate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>trnOpDate, <span class="dt">y=</span>Count, <span class="dt">color=</span>IO)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">900000</span>), <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">900000</span>, <span class="dv">100000</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;日期&quot;</span>, <span class="dt">y=</span><span class="st">&quot;進出站人數&quot;</span>, <span class="dt">color=</span><span class="st">&quot;進出&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;grey20&quot;</span>),
        <span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;grey90&quot;</span>))</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>每個站點每天平均進出站人數</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(staName) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">In=</span><span class="kw">mean</span>(gateInComingCnt), <span class="dt">Out=</span><span class="kw">mean</span>(gateOutGoingCnt)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(In))</code></pre></div>
<pre><code>## # A tibble: 237 x 3
##    staName     In    Out
##    &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1 臺北    63258. 62578.
##  2 桃園    27563. 28538.
##  3 中壢    26588. 26992.
##  4 臺南    25946. 26148.
##  5 臺中    25796. 25064.
##  6 板橋    21320. 21362.
##  7 新竹    20084. 20284.
##  8 高雄    16905. 17002.
##  9 花蓮    16868. 15639.
## 10 松山    16651. 16711.
## # ... with 227 more rows</code></pre>
<p>選取中等規模以上的站點(每天平均進入人數達5000人以上)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cand_sta &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(staName) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">In=</span><span class="kw">mean</span>(gateInComingCnt), <span class="dt">Out=</span><span class="kw">mean</span>(gateOutGoingCnt)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(In<span class="op">&gt;=</span><span class="dv">5000</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>(staName)</code></pre></div>
<p>從原始資料中取出中等規模以上站點的資料</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(staName <span class="op">%in%</span><span class="st"> </span>cand_sta)</code></pre></div>
</div>
<div id="section-7.2.4" class="section level3">
<h3><span class="header-section-number">7.2.4</span> 產生站點資料特徵</h3>
<p>站點資料特徵便是用來一組描述站點特性的資料。</p>
<p>根據前面的折線圖，我們可以觀察到進出站人數具有週期性變化的情形，而其週期大約是一週(一星期)。所以可能可以以一週為單位，彙整資料，避免雜訊(某一天突然增加或減少的異常值)。檢視汐科站在一週每天的進出人數分布範圍。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(staName<span class="op">==</span><span class="st">&quot;汐科&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">In=</span>gateInComingCnt, <span class="dt">Out=</span>gateOutGoingCnt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span><span class="st">&quot;Var&quot;</span>, <span class="dt">value=</span><span class="st">&quot;Count&quot;</span>, <span class="op">-</span>staName, <span class="op">-</span>staCode, <span class="op">-</span>trnOpDate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trnOpDateW=</span><span class="kw">wday</span>(trnOpDate, <span class="dt">label=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Var, <span class="dt">y=</span>Count)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">15000</span>), <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">15000</span>, <span class="dv">3000</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;進出人數&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>trnOpDateW, <span class="dt">nrow=</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;grey&quot;</span>))</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>再檢視臺東站在一週每天的進出人數分布範圍。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(staName<span class="op">==</span><span class="st">&quot;臺東&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">In=</span>gateInComingCnt, <span class="dt">Out=</span>gateOutGoingCnt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span><span class="st">&quot;Var&quot;</span>, <span class="dt">value=</span><span class="st">&quot;Count&quot;</span>, <span class="op">-</span>staName, <span class="op">-</span>staCode, <span class="op">-</span>trnOpDate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trnOpDateW=</span><span class="kw">wday</span>(trnOpDate, <span class="dt">label=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Var, <span class="dt">y=</span>Count)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">15000</span>), <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">15000</span>, <span class="dv">3000</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;進出人數&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>trnOpDateW, <span class="dt">nrow=</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;grey&quot;</span>))</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>最後，檢視臺北站在一週每天的進出人數分布範圍。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(staName<span class="op">==</span><span class="st">&quot;臺北&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">In=</span>gateInComingCnt, <span class="dt">Out=</span>gateOutGoingCnt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span><span class="st">&quot;Var&quot;</span>, <span class="dt">value=</span><span class="st">&quot;Count&quot;</span>, <span class="op">-</span>staName, <span class="op">-</span>staCode, <span class="op">-</span>trnOpDate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trnOpDateW=</span><span class="kw">wday</span>(trnOpDate, <span class="dt">label=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Var, <span class="dt">y=</span>Count)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">90000</span>), <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">90000</span>, <span class="dv">10000</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;進出人數&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>trnOpDateW, <span class="dt">nrow=</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;grey&quot;</span>))</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>注意週日和週五、週六與平日的情形，汐科站平日進出站人數多於週日和週六，每天的進出站人數大致相同；臺東站的週五和週六出站多於進站，週日則相反；臺北站的週五和週六則是進站多於出站；且臺北和臺東的週末進出人數都多於週間平日。</p>
<p>首先，計算每個站點在一週中每天的進出站人數平均值(刪除前後各5%的極端值以避免極端值的影響)。接著以長條圖顯示上述的進出站人數變化現象，。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trnOpDateW=</span><span class="kw">wday</span>(trnOpDate, <span class="dt">label=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(staName, trnOpDateW) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">In=</span><span class="kw">mean</span>(gateInComingCnt, <span class="dt">trim=</span><span class="fl">0.05</span>), <span class="dt">Out=</span><span class="kw">mean</span>(gateOutGoingCnt, <span class="dt">trim=</span><span class="fl">0.05</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span>variable, <span class="dt">value=</span>value, <span class="op">-</span>staName, <span class="op">-</span>trnOpDateW) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(staName) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value=</span>value<span class="op">/</span><span class="kw">sum</span>(value)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(staName <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;汐科&quot;</span>, <span class="st">&quot;臺北&quot;</span>, <span class="st">&quot;臺東&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>trnOpDateW, <span class="dt">y=</span>value, <span class="dt">fill=</span>variable), <span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette=</span><span class="st">&quot;Dark2&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;週&quot;</span>, <span class="dt">y=</span><span class="st">&quot;人數佔全週進出人數比例&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;進出&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>staName, <span class="dt">nrow=</span><span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;grey&quot;</span>),
        <span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;grey&quot;</span>))</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>從長條圖的示意可以觀察到產生的特徵保留上述分析的特性</p>
<p>以下的研究即利用這個觀察到的現象將資料分群。首先產生每一個站點的資料特徵。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sta_inf &lt;-<span class="st"> </span>df1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trnOpDateW=</span><span class="kw">wday</span>(trnOpDate, <span class="dt">locale=</span><span class="st">&quot;English&quot;</span>, <span class="dt">label=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(staName, trnOpDateW) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">In=</span><span class="kw">mean</span>(gateInComingCnt, <span class="dt">trim=</span><span class="fl">0.05</span>), <span class="dt">Out=</span><span class="kw">mean</span>(gateOutGoingCnt, <span class="dt">trim=</span><span class="fl">0.05</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span>variable, <span class="dt">value=</span>value, <span class="op">-</span>staName, <span class="op">-</span>trnOpDateW) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(staName) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value=</span>value<span class="op">/</span><span class="kw">sum</span>(value)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unite</span>(temp, trnOpDateW, variable) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(<span class="dt">key=</span>temp, <span class="dt">value=</span>value)</code></pre></div>
<p>檢視產生的資料</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(sta_inf)</code></pre></div>
<pre><code>##    staName              Fri_In           Fri_Out            Mon_In       
##  Length:36          Min.   :0.07326   Min.   :0.07001   Min.   :0.05812  
##  Class :character   1st Qu.:0.07826   1st Qu.:0.07726   1st Qu.:0.06611  
##  Mode  :character   Median :0.08069   Median :0.08102   Median :0.06852  
##                     Mean   :0.08093   Mean   :0.08144   Mean   :0.06879  
##                     3rd Qu.:0.08204   3rd Qu.:0.08511   3rd Qu.:0.07155  
##                     Max.   :0.10348   Max.   :0.09521   Max.   :0.08118  
##     Mon_Out            Sat_In           Sat_Out            Sun_In       
##  Min.   :0.05801   Min.   :0.04673   Min.   :0.04661   Min.   :0.03923  
##  1st Qu.:0.06479   1st Qu.:0.07045   1st Qu.:0.07007   1st Qu.:0.07137  
##  Median :0.06820   Median :0.07724   Median :0.07856   Median :0.08247  
##  Mean   :0.06847   Mean   :0.07613   Mean   :0.07654   Mean   :0.08113  
##  3rd Qu.:0.07028   3rd Qu.:0.08174   3rd Qu.:0.08311   3rd Qu.:0.09124  
##  Max.   :0.08435   Max.   :0.09755   Max.   :0.09280   Max.   :0.10927  
##     Sun_Out            Thu_In           Thu_Out            Tue_In       
##  Min.   :0.04255   Min.   :0.05563   Min.   :0.05244   Min.   :0.05107  
##  1st Qu.:0.07111   1st Qu.:0.06211   1st Qu.:0.06172   1st Qu.:0.05837  
##  Median :0.08142   Median :0.06532   Median :0.06537   Median :0.06318  
##  Mean   :0.07981   Mean   :0.06604   Mean   :0.06601   Mean   :0.06329  
##  3rd Qu.:0.08954   3rd Qu.:0.07069   3rd Qu.:0.06925   3rd Qu.:0.06941  
##  Max.   :0.10845   Max.   :0.08160   Max.   :0.08438   Max.   :0.08146  
##     Tue_Out            Wed_In           Wed_Out       
##  Min.   :0.04999   Min.   :0.05295   Min.   :0.05000  
##  1st Qu.:0.05815   1st Qu.:0.05939   1st Qu.:0.05931  
##  Median :0.06202   Median :0.06373   Median :0.06343  
##  Mean   :0.06317   Mean   :0.06422   Mean   :0.06400  
##  3rd Qu.:0.06658   3rd Qu.:0.07060   3rd Qu.:0.06869  
##  Max.   :0.08396   Max.   :0.07999   Max.   :0.08200</code></pre>
<p>取出各站點的特徵(第2到最後一個variable)，形成特徵矩陣，用來計算站點間的相似性，也就是估計矩陣的列(row)與列是否相似。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sta_inf.mat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(sta_inf[,<span class="dv">2</span><span class="op">:</span><span class="kw">ncol</span>(sta_inf)])</code></pre></div>
</div>
<div id="section-7.2.5" class="section level3">
<h3><span class="header-section-number">7.2.5</span> 維度縮減</h3>
<p>上面產生的特徵共有14個維度(dimensions)，也就是14個variables。在計算站點間的相似性之前，可以先看看是否可以用比較少的維度，便達到相近的計算結果。這個從高維度轉換成低維度的運算稱為<strong>維度縮減 (dimension reduction)</strong>，是資料探勘中相當重要的步驟。許多研究對於維度縮減提出相當多不同的方法，在此我們選用<strong>主成分分析 (principal component analysis, pca)</strong>。</p>
<p>將資料特徵輸入R語言的主成分分析函數<code>prcomp()</code>。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sta_inf.pca &lt;-<span class="st"> </span><span class="kw">prcomp</span>(sta_inf.mat)</code></pre></div>
<p>主成分分析產生的結果為一組與原先相同維度的矩陣，以上例而言，其結果在<code>sta_inf.pca$x</code>。經過主成分分析後，第一個維度的特徵(稱為PC1)是最重要的資料描述方式，其次是最二個維度的特徵(PC2)，依序下來為PC3、PC4、…。</p>
<p>查看主成分分析產生結果的解釋</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(sta_inf.pca)</code></pre></div>
<pre><code>## Importance of components:
##                            PC1      PC2      PC3      PC4      PC5
## Standard deviation     0.03016 0.008704 0.006323 0.004882 0.003679
## Proportion of Variance 0.84913 0.070720 0.037320 0.022250 0.012640
## Cumulative Proportion  0.84913 0.919850 0.957170 0.979420 0.992050
##                             PC6     PC7     PC8       PC9      PC10
## Standard deviation     0.001855 0.00142 0.00128 0.0007949 0.0005517
## Proportion of Variance 0.003210 0.00188 0.00153 0.0005900 0.0002800
## Cumulative Proportion  0.995260 0.99715 0.99867 0.9992600 0.9995500
##                             PC11      PC12      PC13      PC14
## Standard deviation     0.0004753 0.0004262 0.0002784 1.031e-17
## Proportion of Variance 0.0002100 0.0001700 0.0000700 0.000e+00
## Cumulative Proportion  0.9997600 0.9999300 1.0000000 1.000e+00</code></pre>
<p>。其中的Standard deviation是只用這個維度上的特徵的標準差，可以利用標準差計算變異數所佔的比例(Proportion of Varience)，以第一個維度(PC1)來說，標準差是0.03016 ，經過計算後，變異數所佔的比例為0.84913，也就是只用第一個維度的特徵便可以表現0.84913的訊息，因此第一個維度是最重要的資料描述方式。第二個維度的變異數所佔的比例為0.070720，比第一個維度小，但比其他維度大，所以在資料描述方式上，它是第二重要的。以下依此類推。並且前三個維度(PC1、PC2和PC3)的變異數比例累積(Cumulative Proportion)為0.957170，也就是說只使用這三個維度便可以表現整個資料訊息的0.957170。所以，以下的分析將使用前三個維度。</p>
<p>將各個維度的變異數比例累積畫成圖形來看。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data.frame</span>(<span class="dt">dim_order=</span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(sta_inf.mat)),
           <span class="dt">var=</span>sta_inf.pca<span class="op">$</span>sdev<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop_varex=</span>var<span class="op">/</span><span class="kw">sum</span>(var)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cum_prop_varex=</span><span class="kw">cumsum</span>(prop_varex)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>dim_order, <span class="dt">y=</span>cum_prop_varex)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(sta_inf.mat)), <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="kw">ncol</span>(sta_inf.mat), <span class="dv">1</span>), <span class="dt">minor_breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;維度&quot;</span>, <span class="dt">y=</span><span class="st">&quot;累積變異數比例&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;gray&quot;</span>),
        <span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;gray70&quot;</span>),
        <span class="dt">panel.grid.minor =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;gray90&quot;</span>))</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>取出經過前三個維度的資料。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sta_inf.pf &lt;-<span class="st"> </span>sta_inf.pca<span class="op">$</span>x[, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</code></pre></div>
</div>
<div id="section-7.2.6" class="section level3">
<h3><span class="header-section-number">7.2.6</span> 將站點依據彼此距離視覺化</h3>
<p>本節中將依據站點彼此間的相似性，將各站點映射到圖形上，使相似性較大的站點在圖形上的距離較近</p>
<p>載入映射演算法套件</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(Rtsne)</code></pre></div>
<pre><code>## Warning: package &#39;Rtsne&#39; was built under R version 3.5.3</code></pre>
<p>計算站點之間的距離(相似性可以視為距離的負值，相似性愈大，距離愈小)。<code>dist()</code>提供矩陣的每列之間各種距離的計算方式，這裡我們採用內定而且是最常用的Euclidean distance(歐基里得距離)。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sta_d &lt;-<span class="st"> </span><span class="kw">dist</span>(sta_inf.pf)</code></pre></div>
<p>依據站點特徵之間的歐基里得距離計算站點映射在圖形上的位置</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tsne_out &lt;-<span class="st"> </span><span class="kw">Rtsne</span>(sta_d, <span class="dt">perplexity=</span><span class="dv">10</span>, <span class="dt">theta=</span><span class="fl">0.0</span>, <span class="dt">is_distance=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>將站點加上映射的坐標後，依據其坐標畫成圖形</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sta_inf <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(staName) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x=</span>tsne_out<span class="op">$</span>Y[,<span class="dv">1</span>], <span class="dt">y=</span>tsne_out<span class="op">$</span>Y[,<span class="dv">2</span>]) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">label=</span>staName), <span class="dt">size=</span><span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>()</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
</div>
</div>
<div id="section-7.3" class="section level2">
<h2><span class="header-section-number">7.3</span> 站點分群</h2>
<p>載入分群演算法套件</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(apcluster)</code></pre></div>
<pre><code>## Warning: package &#39;apcluster&#39; was built under R version 3.5.3</code></pre>
<pre><code>## 
## Attaching package: &#39;apcluster&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     heatmap</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s1 &lt;-<span class="st"> </span><span class="op">-</span><span class="kw">as.matrix</span>(sta_d)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span><span class="kw">apcluster</span>(s1)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="kw">length</span>(res<span class="op">@</span>clusters))) {
  <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Cluster&quot;</span>, i))
  <span class="kw">print</span>(sta_inf<span class="op">$</span>staName[res<span class="op">@</span>clusters[[i]]])
}</code></pre></div>
<pre><code>## [1] &quot;Cluster 1&quot;
## [1] &quot;內壢&quot; &quot;埔心&quot; &quot;楊梅&quot; &quot;樹林&quot; &quot;鶯歌&quot;
## [1] &quot;Cluster 2&quot;
## [1] &quot;汐科&quot;
## [1] &quot;Cluster 3&quot;
##  [1] &quot;竹北&quot; &quot;竹南&quot; &quot;板橋&quot; &quot;苗栗&quot; &quot;桃園&quot; &quot;基隆&quot; &quot;新營&quot; &quot;新豐&quot; &quot;瑞芳&quot; &quot;臺北&quot;
## [1] &quot;Cluster 4&quot;
## [1] &quot;七堵&quot; &quot;汐止&quot; &quot;松山&quot; &quot;南港&quot;
## [1] &quot;Cluster 5&quot;
## [1] &quot;新烏日&quot;
## [1] &quot;Cluster 6&quot;
## [1] &quot;斗六&quot; &quot;花蓮&quot; &quot;嘉義&quot; &quot;彰化&quot; &quot;臺中&quot; &quot;臺東&quot; &quot;豐原&quot;
## [1] &quot;Cluster 7&quot;
## [1] &quot;中壢&quot;   &quot;屏東&quot;   &quot;員林&quot;   &quot;高雄&quot;   &quot;新左營&quot; &quot;新竹&quot;   &quot;臺南&quot;   &quot;羅東&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sta.cl &lt;-<span class="st"> </span><span class="kw">integer</span>(<span class="kw">nrow</span>(sta_inf))
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="kw">length</span>(res<span class="op">@</span>clusters))) {
  sta.cl[res<span class="op">@</span>clusters[[i]]] &lt;-<span class="st"> </span>i
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sta_inf <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(staName) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x=</span>tsne_out<span class="op">$</span>Y[,<span class="dv">1</span>], <span class="dt">y=</span>tsne_out<span class="op">$</span>Y[,<span class="dv">2</span>]) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cl=</span><span class="kw">factor</span>(sta.cl)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">label=</span>staName, <span class="dt">color=</span>cl), <span class="dt">size=</span><span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="kw">min</span>(tsne_out<span class="op">$</span>Y[,<span class="dv">1</span>])<span class="op">-</span><span class="dv">1</span>, <span class="kw">max</span>(tsne_out<span class="op">$</span>Y[,<span class="dv">1</span>])<span class="op">+</span><span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="kw">min</span>(tsne_out<span class="op">$</span>Y[,<span class="dv">2</span>])<span class="op">-</span><span class="dv">1</span>, <span class="kw">max</span>(tsne_out<span class="op">$</span>Y[,<span class="dv">2</span>])<span class="op">+</span><span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,
        <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;grey&quot;</span>))</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemplars &lt;-<span class="st"> </span>sta_inf <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(res<span class="op">@</span>exemplars) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>(staName)

df1 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">trnOpDateW=</span><span class="kw">wday</span>(trnOpDate, <span class="dt">label=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(staName <span class="op">%in%</span><span class="st"> </span>exemplars) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(staName, trnOpDateW) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">In=</span><span class="kw">mean</span>(gateInComingCnt), <span class="dt">Out=</span><span class="kw">mean</span>(gateOutGoingCnt)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span>variable, <span class="dt">value=</span>value, <span class="op">-</span>staName, <span class="op">-</span>trnOpDateW) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(staName) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value=</span>value<span class="op">/</span><span class="kw">sum</span>(value)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>trnOpDateW, <span class="dt">y=</span>value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(staName<span class="op">~</span>variable)</code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="statistical-analysis.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/07_unsuperivsed_ml.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
